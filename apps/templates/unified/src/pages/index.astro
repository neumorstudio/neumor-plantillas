---
/**
 * NEUMORSTUDIO - Plantilla Unificada Multi-Tenant
 *
 * Esta p√°gina detecta el tipo de negocio del tenant y renderiza
 * el template correspondiente.
 */
import type { TenantData } from "../middleware";

// Get tenant from middleware
const tenant = Astro.locals.tenant as TenantData | undefined;

if (!tenant) {
  return Astro.redirect("/404");
}

// Dynamically rewrite to the correct template based on business type
const businessType = tenant.businessType;
console.log("[Index] Rendering template for:", businessType);

// Preserve query string for preview mode support
const url = new URL(Astro.request.url);
const queryString = url.search; // includes the "?" if present

// Rewrite to the business-specific template (preserving query params)
return Astro.rewrite(`/templates/${businessType}${queryString}`);
---
