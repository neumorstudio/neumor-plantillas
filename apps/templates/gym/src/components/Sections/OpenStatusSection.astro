---
interface Props {
  businessHours?: Array<{
    day_of_week: number;
    is_open: boolean;
    open_time: string;
    close_time: string;
  }>;
  variant?: "pulse" | "morph" | "liquid" | "time";
}

const { businessHours = [], variant = "pulse" } = Astro.props;

const dayNames = ["Domingo", "Lunes", "Martes", "Miércoles", "Jueves", "Viernes", "Sábado"];

// Calcular si está abierto ahora
const now = new Date();
const currentDay = now.getDay();
const currentTime = now.toTimeString().slice(0, 5);

const todayHours = businessHours.find(h => h.day_of_week === currentDay);
const isOpenNow = todayHours?.is_open &&
  todayHours.open_time &&
  todayHours.close_time &&
  currentTime >= todayHours.open_time.slice(0, 5) &&
  currentTime <= todayHours.close_time.slice(0, 5);
---

<section id="open-status" class="section section-compact">
  <div class="container">
    <div class="status-wrapper neumor-card">
      <div class={`status-indicator ${isOpenNow ? 'open' : 'closed'} ${variant}`}>
        <span class="status-dot"></span>
        <span class="status-text">{isOpenNow ? 'Abierto ahora' : 'Cerrado'}</span>
      </div>
      {todayHours && todayHours.is_open && (
        <div class="status-hours">
          <span class="today-label">Hoy:</span>
          <span class="today-hours">
            {todayHours.open_time.slice(0, 5)} - {todayHours.close_time.slice(0, 5)}
          </span>
        </div>
      )}
    </div>
  </div>
</section>

<style>
  .section-compact {
    padding: 2rem 0;
  }

  .status-wrapper {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 2rem;
    padding: 1.5rem 2rem;
    border-radius: 1rem;
    max-width: 400px;
    margin: 0 auto;
  }

  .status-indicator {
    display: flex;
    align-items: center;
    gap: 0.75rem;
  }

  .status-dot {
    width: 12px;
    height: 12px;
    border-radius: 50%;
    position: relative;
  }

  .status-indicator.open .status-dot {
    background: #22c55e;
  }

  .status-indicator.closed .status-dot {
    background: #ef4444;
  }

  .status-indicator.pulse .status-dot::after {
    content: '';
    position: absolute;
    inset: -4px;
    border-radius: 50%;
    animation: pulse 2s ease-in-out infinite;
  }

  .status-indicator.pulse.open .status-dot::after {
    background: rgba(34, 197, 94, 0.3);
  }

  .status-indicator.pulse.closed .status-dot::after {
    background: rgba(239, 68, 68, 0.3);
  }

  @keyframes pulse {
    0%, 100% {
      transform: scale(1);
      opacity: 1;
    }
    50% {
      transform: scale(1.5);
      opacity: 0;
    }
  }

  .status-text {
    font-weight: 600;
    color: var(--text-primary);
  }

  .status-hours {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    color: var(--text-secondary);
    font-size: 0.95rem;
  }

  .today-label {
    opacity: 0.7;
  }

  .today-hours {
    font-weight: 500;
  }

  @media (max-width: 480px) {
    .status-wrapper {
      flex-direction: column;
      gap: 1rem;
    }
  }
</style>
